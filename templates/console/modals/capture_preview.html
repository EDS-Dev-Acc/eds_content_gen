<!-- Capture Preview Modal -->
<!-- Phase 16: Preview raw HTML capture for a seed -->

<div class="relative z-50" aria-labelledby="modal-title" role="dialog" aria-modal="true">
    <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"></div>
    
    <div class="fixed inset-0 z-10 overflow-y-auto">
        <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
            <div class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-4xl">
                <!-- Header -->
                <div class="bg-gray-50 px-4 py-3 border-b flex justify-between items-center">
                    <h3 class="text-lg font-semibold text-gray-900" id="modal-title">
                        Raw Capture Preview
                    </h3>
                    <button type="button" 
                            class="rounded-md text-gray-400 hover:text-gray-500"
                            onclick="document.getElementById('modal-container').innerHTML = ''">
                        <span class="sr-only">Close</span>
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
                
                <!-- Capture info -->
                <div class="px-4 py-3 border-b bg-gray-50">
                    <div class="flex flex-wrap gap-4 text-sm">
                        <div>
                            <span class="text-gray-500">URL:</span>
                            <a href="{{ seed.url }}" target="_blank" class="text-indigo-600 hover:underline ml-1">
                                {{ seed.url|truncatechars:60 }}
                            </a>
                        </div>
                        {% if capture %}
                        <div>
                            <span class="text-gray-500">Status:</span>
                            <span class="ml-1 font-medium">{{ capture.status_code }}</span>
                        </div>
                        <div>
                            <span class="text-gray-500">Content-Type:</span>
                            <span class="ml-1">{{ capture.content_type }}</span>
                        </div>
                        <div>
                            <span class="text-gray-500">Size:</span>
                            <span class="ml-1">{{ capture.body_size|filesizeformat }}</span>
                        </div>
                        <div>
                            <span class="text-gray-500">Captured:</span>
                            <span class="ml-1">{{ capture.fetch_timestamp|timesince }} ago</span>
                        </div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Content preview -->
                <div class="px-4 py-4 max-h-96 overflow-auto">
                    {% if capture %}
                        {% if capture.content_type|slice:":9" == "text/html" %}
                        <!-- HTML preview as iframe sandbox -->
                        <div class="border rounded bg-white">
                            <div class="bg-gray-100 px-3 py-1 border-b text-xs text-gray-500">
                                HTML Preview (sandboxed)
                            </div>
                            <pre class="p-3 text-xs overflow-x-auto bg-gray-50 whitespace-pre-wrap font-mono max-h-80">{{ capture.get_text|truncatechars:10000 }}</pre>
                        </div>
                        {% elif capture.content_type|slice:":16" == "application/json" %}
                        <!-- JSON preview -->
                        <pre class="p-3 text-sm bg-gray-900 text-green-400 rounded overflow-x-auto font-mono max-h-80">{{ capture.get_text|truncatechars:10000 }}</pre>
                        {% elif capture.content_type|slice:":8" == "text/xml" or capture.content_type|slice:":15" == "application/xml" %}
                        <!-- XML preview -->
                        <pre class="p-3 text-sm bg-gray-900 text-blue-400 rounded overflow-x-auto font-mono max-h-80">{{ capture.get_text|truncatechars:10000 }}</pre>
                        {% else %}
                        <!-- Generic text preview -->
                        <pre class="p-3 text-sm bg-gray-100 rounded overflow-x-auto font-mono max-h-80">{{ capture.get_text|truncatechars:10000 }}</pre>
                        {% endif %}
                        
                        <!-- Response headers -->
                        <details class="mt-4">
                            <summary class="text-sm font-medium text-gray-700 cursor-pointer">
                                Response Headers
                            </summary>
                            <pre class="mt-2 p-3 text-xs bg-gray-100 rounded overflow-x-auto font-mono">{% for key, value in capture.headers.items %}{{ key }}: {{ value }}
{% endfor %}</pre>
                        </details>
                    {% else %}
                        <div class="text-center py-12 text-gray-500">
                            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <p class="mt-2 text-sm">No capture available for this seed.</p>
                            <p class="mt-1 text-xs text-gray-400">Captures are stored during discovery runs.</p>
                        </div>
                    {% endif %}
                </div>
                
                <!-- Footer -->
                <div class="bg-gray-50 px-4 py-3 border-t flex justify-end gap-3">
                    {% if capture %}
                    <a href="{{ seed.url }}" 
                       target="_blank"
                       class="inline-flex items-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50">
                        <svg class="h-4 w-4 mr-1.5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 003 8.25v10.5A2.25 2.25 0 005.25 21h10.5A2.25 2.25 0 0018 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25" />
                        </svg>
                        Open Live URL
                    </a>
                    {% endif %}
                    <button type="button"
                            onclick="document.getElementById('modal-container').innerHTML = ''"
                            class="inline-flex justify-center rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
