{% extends 'base.html' %}
{% load static %}

{% block title %}Seed Review Queue - EMCIP Operator Console{% endblock %}

{% block page_title %}Seed Review Queue{% endblock %}

{% block content %}
<div class="px-4 sm:px-6 lg:px-8 py-8">
    <!-- Page header -->
    <div class="sm:flex sm:items-center sm:justify-between">
        <div>
            <h1 class="text-2xl font-bold leading-7 text-gray-900 sm:truncate sm:text-3xl">
                Seed Review Queue
            </h1>
            <p class="mt-1 text-sm text-gray-500">
                Review and approve discovered seed URLs for promotion to sources.
            </p>
        </div>
        <div class="mt-4 sm:mt-0 flex items-center gap-3">
            <!-- Discovery runs status -->
            <button hx-get="{% url 'console:discovery_new' %}"
                    hx-target="#modal-container"
                    hx-swap="innerHTML"
                    class="inline-flex items-center rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500">
                <svg class="h-4 w-4 mr-1.5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
                </svg>
                New Discovery
            </button>
        </div>
    </div>
    
    <!-- Discovery Runs Section (collapsed by default) -->
    <details class="mt-6 bg-white rounded-lg shadow">
        <summary class="px-4 py-3 cursor-pointer text-sm font-medium text-gray-900 hover:bg-gray-50 rounded-t-lg">
            <span class="ml-2">Recent Discovery Runs</span>
        </summary>
        <div id="discovery-runs"
             hx-get="{% url 'console:discovery_runs' %}"
             hx-trigger="revealed"
             hx-swap="innerHTML">
            <div class="p-4 text-center text-gray-500">
                <svg class="animate-spin h-5 w-5 mx-auto text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
            </div>
        </div>
    </details>
    
    <!-- Review Queue Section -->
    <div class="mt-6">
        <div id="review-queue"
             hx-get="{% url 'console:seeds_review_queue' %}"
             hx-trigger="load"
             hx-swap="innerHTML">
            <div class="bg-white rounded-lg shadow p-8 text-center text-gray-500">
                <svg class="animate-spin h-8 w-8 mx-auto text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <p class="mt-3">Loading review queue...</p>
            </div>
        </div>
    </div>
</div>

<!-- Modal container for HTMX modals -->
<div id="modal-container"></div>
{% endblock %}

{% block extra_js %}
<script>
// Select all checkbox functionality
document.addEventListener('htmx:afterSwap', function(event) {
    const selectAll = document.getElementById('select-all');
    if (selectAll) {
        selectAll.addEventListener('change', function() {
            const checkboxes = document.querySelectorAll('.seed-checkbox:not([disabled])');
            checkboxes.forEach(cb => cb.checked = this.checked);
        });
    }
});
</script>
{% endblock %}
