<!-- Per-Source Overrides Drawer -->
<!-- Slides in from the right when user clicks "Configure" on a source -->
<div id="source-overrides-drawer" 
     x-data="{ 
         open: false, 
         source: null,
         overrides: {},
         setSource(s) {
             this.source = s;
             this.overrides = s.overrides || {};
             this.open = true;
         },
         save() {
             // Emit event to update parent
             this.$dispatch('source-override-saved', { 
                 sourceId: this.source.id, 
                 overrides: this.overrides 
             });
             this.open = false;
         }
     }"
     @open-source-overrides.window="setSource($event.detail)"
     x-show="open"
     x-cloak
     class="fixed inset-0 z-50 overflow-hidden"
     aria-labelledby="slide-over-title" 
     role="dialog" 
     aria-modal="true">
    
    <!-- Backdrop -->
    <div x-show="open" 
         x-transition:enter="ease-in-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="ease-in-out duration-300"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         @click="open = false"
         class="absolute inset-0 bg-gray-500 bg-opacity-75 transition-opacity"></div>

    <!-- Panel -->
    <div class="pointer-events-none fixed inset-y-0 right-0 flex max-w-full pl-10">
        <div x-show="open"
             x-transition:enter="transform transition ease-in-out duration-300"
             x-transition:enter-start="translate-x-full"
             x-transition:enter-end="translate-x-0"
             x-transition:leave="transform transition ease-in-out duration-300"
             x-transition:leave-start="translate-x-0"
             x-transition:leave-end="translate-x-full"
             class="pointer-events-auto w-screen max-w-md">
            
            <div class="flex h-full flex-col overflow-y-scroll bg-white shadow-xl">
                <!-- Header -->
                <div class="bg-indigo-700 px-4 py-6 sm:px-6">
                    <div class="flex items-center justify-between">
                        <h2 id="slide-over-title" class="text-base font-semibold text-white">
                            Source Overrides
                        </h2>
                        <div class="ml-3 flex h-7 items-center">
                            <button type="button" 
                                    @click="open = false"
                                    class="rounded-md bg-indigo-700 text-indigo-200 hover:text-white focus:outline-none focus:ring-2 focus:ring-white">
                                <span class="sr-only">Close panel</span>
                                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="mt-1">
                        <p class="text-sm text-indigo-300" x-text="source?.name || 'Source'"></p>
                        <p class="text-xs text-indigo-400 truncate" x-text="source?.url || ''"></p>
                    </div>
                </div>

                <!-- Content -->
                <div class="flex-1 px-4 py-6 sm:px-6">
                    <div class="space-y-6">
                        <!-- Info -->
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                            <p class="text-sm text-blue-800">
                                Override settings for this specific source. Leave blank to use the job defaults.
                            </p>
                        </div>

                        <!-- Max Pages Override -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Max Pages Override</label>
                            <input type="number" 
                                   x-model="overrides.max_pages"
                                   placeholder="Use job default"
                                   min="1" max="100000"
                                   class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                            <p class="text-xs text-gray-500 mt-1">Maximum pages to crawl from this source</p>
                        </div>

                        <!-- Crawl Depth Override -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Crawl Depth Override</label>
                            <input type="number" 
                                   x-model="overrides.crawl_depth"
                                   placeholder="Use job default"
                                   min="0" max="20"
                                   class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                            <p class="text-xs text-gray-500 mt-1">Maximum link hops from entry page</p>
                        </div>

                        <!-- Fetch Mode Override -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Fetch Mode Override</label>
                            <select x-model="overrides.fetch_mode"
                                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                                <option value="">Use job default</option>
                                <option value="http">Standard HTTP</option>
                                <option value="headless">Headless Browser</option>
                                <option value="hybrid">Hybrid</option>
                            </select>
                            <p class="text-xs text-gray-500 mt-1">Override for sources requiring JavaScript</p>
                        </div>

                        <!-- Rate Limiting Override -->
                        <div class="border-t pt-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Rate Limiting</label>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs text-gray-600">Delay (ms)</label>
                                    <input type="number" 
                                           x-model="overrides.rate_delay_ms"
                                           placeholder="Default"
                                           min="0" max="60000"
                                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                                </div>
                                <div>
                                    <label class="block text-xs text-gray-600">Max Concurrent</label>
                                    <input type="number" 
                                           x-model="overrides.max_concurrent"
                                           placeholder="Default"
                                           min="1" max="100"
                                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                                </div>
                            </div>
                        </div>

                        <!-- Proxy Override -->
                        <div class="border-t pt-4">
                            <label class="block text-sm font-medium text-gray-700">Proxy Override</label>
                            <select x-model="overrides.proxy_group"
                                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                                <option value="">Use job default</option>
                                <option value="none">No Proxy</option>
                                <option value="residential_us">Residential US</option>
                                <option value="residential_eu">Residential EU</option>
                                <option value="datacenter">Datacenter</option>
                                <option value="mobile">Mobile</option>
                            </select>
                            <p class="text-xs text-gray-500 mt-1">Force specific proxy for this source</p>
                        </div>

                        <!-- Custom Headers -->
                        <div class="border-t pt-4">
                            <label class="block text-sm font-medium text-gray-700">Custom Headers</label>
                            <textarea x-model="overrides.custom_headers"
                                      placeholder="Authorization: Bearer xxx&#10;X-API-Key: xxx"
                                      rows="3"
                                      class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm font-mono text-xs"></textarea>
                            <p class="text-xs text-gray-500 mt-1">One header per line (Key: Value)</p>
                        </div>

                        <!-- Include/Exclude Patterns -->
                        <div class="border-t pt-4">
                            <label class="block text-sm font-medium text-gray-700">URL Pattern Overrides</label>
                            <div class="mt-2 space-y-3">
                                <div>
                                    <label class="block text-xs text-gray-600">Include Patterns</label>
                                    <textarea x-model="overrides.include_patterns"
                                              placeholder="/news/.*&#10;/articles/.*"
                                              rows="2"
                                              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm font-mono text-xs"></textarea>
                                </div>
                                <div>
                                    <label class="block text-xs text-gray-600">Exclude Patterns</label>
                                    <textarea x-model="overrides.exclude_patterns"
                                              placeholder="/login.*&#10;/register.*"
                                              rows="2"
                                              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm font-mono text-xs"></textarea>
                                </div>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">Regex patterns, one per line</p>
                        </div>
                    </div>
                </div>

                <!-- Footer -->
                <div class="flex flex-shrink-0 justify-end gap-3 border-t border-gray-200 px-4 py-4">
                    <button type="button" 
                            @click="overrides = {}; open = false"
                            class="rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50">
                        Clear Overrides
                    </button>
                    <button type="button" 
                            @click="open = false"
                            class="rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50">
                        Cancel
                    </button>
                    <button type="button" 
                            @click="save()"
                            class="rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
                        Save Overrides
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
